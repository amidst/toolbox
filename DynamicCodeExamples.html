<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>AMIDST Toolbox 0.4.2 by amidst</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">AMIDST Toolbox 0.4.2</h1>
      <h2 class="project-tagline">A Java Toolbox for Analysis of MassIve Data STreams using Probabilistic Graphical Models</h2>
      <a href="https://github.com/amidst/toolbox" class="btn">View on GitHub</a>
      <a href="https://github.com/amidst/toolbox/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/amidst/toolbox/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h2>
<a id="dynamic-bayesian-networks-code-examples" class="anchor" href="#dynamic-bayesian-networks-code-examples" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Dynamic Bayesian networks: code Examples<a name="documentation"></a>
</h2>

<ul>
<li><a href="#dynamicdatastreamsexample">Dynamic Data Streams</a></li>
<li><a href="#dynamicvariablesexample">Dynamic Random Variables</a></li>
<li>
<a href="#dynamicbnexample">Dynamic Bayesian Networks</a>

<ul>
<li><a href="#dynamicbn">Creating Dynamic Bayesian Networks</a></li>
<li><a href="#dynamicbnhidden">Creating Dynamic Bayesian Networks with Latent Variables</a></li>
<li><a href="#dynamicbnmodify">Modifying Bayesian Networks</a></li>
</ul>
</li>
<li><a href="#sampledynamicbn">Sampling from Dynamic Bayesian Networks</a></li>
<li>
<a href="#dynamicinferenceexample">Inference Algorithms for Dynamic Bayesian Networks</a>

<ul>
<li><a href="#dynamicmap">The Dynamic MAP Inference</a></li>
<li><a href="#dynamicvmp">The Dynamic Variational Message Passing</a></li>
<li><a href="#dynamicis">The Dynamic Importance Sampling</a></li>
</ul>
</li>
<li>
<a href="#dynamiclearningexample">Dynamic Learning Algorithms</a>

<ul>
<li><a href="#dynamicml">Maximum Likelihood for DBNs</a></li>
<li><a href="#dynamicsvb">Streaming Variational Bayes for DBNs</a></li>
</ul>
</li>
</ul>

<h2>
<a id="dynamic-data-streams" class="anchor" href="#dynamic-data-streams" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Dynamic Data Streams<a name="dynamicdatastreamsexample"></a>
</h2>

<p>In this example we show how to use the main features of a <em>DataStream</em> object. More precisely,  we show  how to load a dynamic data stream and how to iterate over the <em>DynamicDataInstance</em> objects.</p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">//Open the data stream using the class DynamicDataStreamLoader</span>
<span class="pl-k">DataStream&lt;<span class="pl-smi">DynamicDataInstance</span>&gt;</span> data <span class="pl-k">=</span> <span class="pl-smi">DynamicDataStreamLoader</span><span class="pl-k">.</span>loadFromFile(<span class="pl-s"><span class="pl-pds">"</span>datasets/dynamicNB-samples.arff<span class="pl-pds">"</span></span>);

<span class="pl-c">//Access the attributes defining the data stream</span>
<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>Attributes defining the data set<span class="pl-pds">"</span></span>);
<span class="pl-k">for</span> (<span class="pl-smi">Attribute</span> attribute <span class="pl-k">:</span> data<span class="pl-k">.</span>getAttributes()) {
    <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(attribute<span class="pl-k">.</span>getName());
}
<span class="pl-smi">Attribute</span> classVar <span class="pl-k">=</span> data<span class="pl-k">.</span>getAttributes()<span class="pl-k">.</span>getAttributeByName(<span class="pl-s"><span class="pl-pds">"</span>ClassVar<span class="pl-pds">"</span></span>);

<span class="pl-c">//Iterate over dynamic data instances</span>
<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>1. Iterating over samples using a for loop<span class="pl-pds">"</span></span>);
<span class="pl-k">for</span> (<span class="pl-smi">DynamicDataInstance</span> dataInstance <span class="pl-k">:</span> data) {
    <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>SequenceID = <span class="pl-pds">"</span></span><span class="pl-k">+</span>dataInstance<span class="pl-k">.</span>getSequenceID()<span class="pl-k">+</span><span class="pl-s"><span class="pl-pds">"</span>, TimeID = <span class="pl-pds">"</span></span><span class="pl-k">+</span>dataInstance<span class="pl-k">.</span>getTimeID());
    <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>The value of attribute A for the current data instance is: <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
        dataInstance<span class="pl-k">.</span>getValue(classVar));
}</pre></div>

<p><a href="#documentation">[Back to Top]</a></p>

<h2>
<a id="dynamic-random-variables" class="anchor" href="#dynamic-random-variables" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Dynamic Random Variables<a name="dynamicvariablesexample"></a>
</h2>

<p>This example show the basic functionalities related to dynamic variables.</p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">//Create an empty DynamicVariables object</span>
<span class="pl-smi">DynamicVariables</span> variables <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DynamicVariables</span>();

<span class="pl-c">//Invoke the "new" methods of the object DynamicVariables to create new dynamic variables.</span>

<span class="pl-c">//Create a Gaussian dynamic variables</span>
<span class="pl-smi">Variable</span> gaussianVar <span class="pl-k">=</span> variables<span class="pl-k">.</span>newGaussianDynamicVariable(<span class="pl-s"><span class="pl-pds">"</span>GaussianVar<span class="pl-pds">"</span></span>);

<span class="pl-c">//Create a Multinomial dynamic variable with two states</span>
<span class="pl-smi">Variable</span> multinomialVar <span class="pl-k">=</span> variables<span class="pl-k">.</span>newMultinomialDynamicVariable(<span class="pl-s"><span class="pl-pds">"</span>MultinomialVar<span class="pl-pds">"</span></span>, <span class="pl-c1">2</span>);

<span class="pl-c">//Create a Multinomial dynamic variable with two states: TRUE and FALSE</span>
<span class="pl-smi">Variable</span> multinomialVar2 <span class="pl-k">=</span> variables<span class="pl-k">.</span>newMultinomialDynamicVariable(<span class="pl-s"><span class="pl-pds">"</span>MultinomialVar2<span class="pl-pds">"</span></span>, <span class="pl-smi">Arrays</span><span class="pl-k">.</span>asList(<span class="pl-s"><span class="pl-pds">"</span>TRUE, FALSE<span class="pl-pds">"</span></span>));

<span class="pl-c">//All dynamic Variables have an interface variable</span>
<span class="pl-smi">Variable</span> gaussianVarInt <span class="pl-k">=</span> gaussianVar<span class="pl-k">.</span>getInterfaceVariable();
<span class="pl-smi">Variable</span> multinomialVarInt <span class="pl-k">=</span> multinomialVar<span class="pl-k">.</span>getInterfaceVariable();

<span class="pl-c">//Get the "main" Variable associated with each interface variable through the DynamicVariable object</span>
<span class="pl-smi">Variable</span> mainMultinomialVar <span class="pl-k">=</span> variables<span class="pl-k">.</span>getVariableFromInterface(multinomialVarInt);

<span class="pl-c">//Check whether a variable is an interface variable</span>
<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>Is Variable <span class="pl-pds">"</span></span><span class="pl-k">+</span>gaussianVar<span class="pl-k">.</span>getName()<span class="pl-k">+</span><span class="pl-s"><span class="pl-pds">"</span> an interface variable? <span class="pl-pds">"</span></span>
                <span class="pl-k">+</span>gaussianVar<span class="pl-k">.</span>isInterfaceVariable());
<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>Is Variable <span class="pl-pds">"</span></span><span class="pl-k">+</span>gaussianVarInt<span class="pl-k">.</span>getName()<span class="pl-k">+</span><span class="pl-s"><span class="pl-pds">"</span> an interface variable? <span class="pl-pds">"</span></span>
                <span class="pl-k">+</span>gaussianVarInt<span class="pl-k">.</span>isInterfaceVariable());

<span class="pl-c">//Check whether a variable is a dynamic variable</span>
<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>Is Variable <span class="pl-pds">"</span></span><span class="pl-k">+</span>multinomialVar<span class="pl-k">.</span>getName()<span class="pl-k">+</span><span class="pl-s"><span class="pl-pds">"</span> a dynamic variable? <span class="pl-pds">"</span></span>
                <span class="pl-k">+</span>gaussianVar<span class="pl-k">.</span>isDynamicVariable());</pre></div>

<p><a href="#documentation">[Back to Top]</a></p>

<h2>
<a id="dynamic-bayesian-networks" class="anchor" href="#dynamic-bayesian-networks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Dynamic Bayesian Networks<a name="dynamicbnexample"></a>
</h2>

<h3>
<a id="creating-dynamic-bayesian-networks" class="anchor" href="#creating-dynamic-bayesian-networks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Creating Dynamic Bayesian networks<a name="dynamicbn"></a>
</h3>

<p>This example creates a dynamic BN, from a dynamic data stream, with randomly generated probability distributions, then saves it to a file.</p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">//Open the data stream using the static class DynamicDataStreamLoader</span>
<span class="pl-k">DataStream&lt;<span class="pl-smi">DynamicDataInstance</span>&gt;</span> data <span class="pl-k">=</span> <span class="pl-smi">DynamicDataStreamLoader</span><span class="pl-k">.</span>loadFromFile(
                <span class="pl-s"><span class="pl-pds">"</span>datasets/syntheticDataDiscrete.arff<span class="pl-pds">"</span></span>);

<span class="pl-c">/**</span>
<span class="pl-c">* 1. Once the data is loaded, we create a random variable for each of the attributes (i.e. data columns)</span>
<span class="pl-c">* in our data.</span>
<span class="pl-c">*</span>
<span class="pl-c">* 2. {@link DynamicVariables} is the class for doing that. It takes a list of Attributes and internally creates</span>
<span class="pl-c">* all the variables. We create the variables using DynamicVariables class to guarantee that each variable</span>
<span class="pl-c">* has a different ID number and make it transparent for the user. Each random variable has an associated</span>
<span class="pl-c">* interface variable.</span>
<span class="pl-c">*</span>
<span class="pl-c">* 3. We can extract the Variable objects by using the method getVariableByName();</span>
<span class="pl-c">*/</span>
<span class="pl-smi">DynamicVariables</span> dynamicVariables <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DynamicVariables</span>(data<span class="pl-k">.</span>getAttributes());
<span class="pl-smi">DynamicDAG</span> dynamicDAG <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DynamicDAG</span>(dynamicVariables);

<span class="pl-smi">Variable</span> <span class="pl-smi">A</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getVariableByName(<span class="pl-s"><span class="pl-pds">"</span>A<span class="pl-pds">"</span></span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">B</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getVariableByName(<span class="pl-s"><span class="pl-pds">"</span>B<span class="pl-pds">"</span></span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">C</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getVariableByName(<span class="pl-s"><span class="pl-pds">"</span>C<span class="pl-pds">"</span></span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">D</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getVariableByName(<span class="pl-s"><span class="pl-pds">"</span>D<span class="pl-pds">"</span></span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">E</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getVariableByName(<span class="pl-s"><span class="pl-pds">"</span>E<span class="pl-pds">"</span></span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">G</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getVariableByName(<span class="pl-s"><span class="pl-pds">"</span>G<span class="pl-pds">"</span></span>);

<span class="pl-smi">Variable</span> <span class="pl-smi">A_Interface</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getInterfaceVariable(<span class="pl-smi">A</span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">B_Interface</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getInterfaceVariable(<span class="pl-smi">B</span>);

<span class="pl-c">//Note that C_Interface and D_Interface are also created although they will not be used</span>
<span class="pl-c">//(we will not add temporal dependencies)</span>

<span class="pl-smi">Variable</span> <span class="pl-smi">E_Interface</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getInterfaceVariable(<span class="pl-smi">E</span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">G_Interface</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getInterfaceVariable(<span class="pl-smi">G</span>);

<span class="pl-c">// Example of the dynamic DAG structure</span>
<span class="pl-c">// Time 0: Parents at time 0 are automatically created when adding parents at time T</span>
dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">B</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">A</span>);
dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">C</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">A</span>);
dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">D</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">A</span>);
dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">E</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">A</span>);
dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">G</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">A</span>);
dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">A</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">A_Interface</span>);
dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">B</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">B_Interface</span>);
dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">E</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">E_Interface</span>);
dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">G</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">G_Interface</span>);

<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(dynamicDAG<span class="pl-k">.</span>toString());

<span class="pl-c">/**</span>
<span class="pl-c">* 1. We now create the Dynamic Bayesian network from the previous Dynamic DAG.</span>
<span class="pl-c">*</span>
<span class="pl-c">* 2. The DBN object is created from the DynamicDAG. It automatically looks at the distribution type</span>
<span class="pl-c">* of each variable and their parents to initialize the Distributions objects that are stored</span>
<span class="pl-c">* inside (i.e. Multinomial, Normal, CLG, etc). The parameters defining these distributions are</span>
<span class="pl-c">* properly initialized.</span>
<span class="pl-c">*</span>
<span class="pl-c">* 3. The network is printed and we can have a look at the kind of distributions stored in the DBN object.</span>
<span class="pl-c">*/</span>
<span class="pl-smi">DynamicBayesianNetwork</span> dbn <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DynamicBayesianNetwork</span>(dynamicDAG);
<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>printf(dbn<span class="pl-k">.</span>toString());

<span class="pl-c">/**</span>
<span class="pl-c">* Finally teh Bayesian network is saved to a file.</span>
<span class="pl-c">*/</span>
<span class="pl-smi">DynamicBayesianNetworkWriter</span><span class="pl-k">.</span>saveToFile(dbn, <span class="pl-s"><span class="pl-pds">"</span>networks/DBNExample.bn<span class="pl-pds">"</span></span>);</pre></div>

<p><a href="#documentation">[Back to Top]</a></p>

<h3>
<a id="creating-dynamic-bayesian-networks-with-latent-variables-" class="anchor" href="#creating-dynamic-bayesian-networks-with-latent-variables-" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Creating Dynamic Bayesian Networks with Latent Variables <a name="dynamicbnhidden"></a>
</h3>

<p>This example shows how to create a BN model with hidden variables. We simply create a BN for clustering, i.e., a naive Bayes like structure with a single hidden variable acting as parant of all the remaining observable variables.</p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">//Open the data stream using DynamicDataStreamLoader</span>
<span class="pl-k">DataStream&lt;<span class="pl-smi">DynamicDataInstance</span>&gt;</span> data <span class="pl-k">=</span> <span class="pl-smi">DynamicDataStreamLoader</span><span class="pl-k">.</span>loadFromFile(
                <span class="pl-s"><span class="pl-pds">"</span>datasets/syntheticDataDiscrete.arff<span class="pl-pds">"</span></span>);

<span class="pl-c">/**</span>
<span class="pl-c">* 1. Once the data is loaded, create a random variable for each of the attributes (i.e. data columns)</span>
<span class="pl-c">*</span>
<span class="pl-c">* 2. {@link DynamicVariables} is the class for doing that. It takes a list of Attributes and internally creates</span>
<span class="pl-c">* all the variables. We create the variables using DynamicVariables class to guarantee that each variable</span>
<span class="pl-c">* has a different ID number and make it transparent for the user. Each random variable has an associated</span>
<span class="pl-c">* interface variable.</span>
<span class="pl-c">*</span>
<span class="pl-c">* 3. Extract the Variable objects by using the method getVariableByName()</span>
<span class="pl-c">*/</span>
<span class="pl-smi">DynamicVariables</span> dynamicVariables <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DynamicVariables</span>(data<span class="pl-k">.</span>getAttributes());

<span class="pl-smi">Variable</span> <span class="pl-smi">A</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getVariableByName(<span class="pl-s"><span class="pl-pds">"</span>A<span class="pl-pds">"</span></span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">B</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getVariableByName(<span class="pl-s"><span class="pl-pds">"</span>B<span class="pl-pds">"</span></span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">C</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getVariableByName(<span class="pl-s"><span class="pl-pds">"</span>C<span class="pl-pds">"</span></span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">D</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getVariableByName(<span class="pl-s"><span class="pl-pds">"</span>D<span class="pl-pds">"</span></span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">E</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getVariableByName(<span class="pl-s"><span class="pl-pds">"</span>E<span class="pl-pds">"</span></span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">G</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getVariableByName(<span class="pl-s"><span class="pl-pds">"</span>G<span class="pl-pds">"</span></span>);

<span class="pl-smi">Variable</span> <span class="pl-smi">A_Interface</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getInterfaceVariable(<span class="pl-smi">A</span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">B_Interface</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getInterfaceVariable(<span class="pl-smi">B</span>);

<span class="pl-c">//Note that C_Interface and D_Interface are also created although they will not be used</span>
<span class="pl-c">//(we will not add temporal dependencies)</span>

<span class="pl-smi">Variable</span> <span class="pl-smi">E_Interface</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getInterfaceVariable(<span class="pl-smi">E</span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">G_Interface</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getInterfaceVariable(<span class="pl-smi">G</span>);

<span class="pl-c">/*</span>
<span class="pl-c">* Add a hidden multinomial variable (with 2 states) as parent of all variables except A</span>
<span class="pl-c">*/</span>

<span class="pl-smi">Variable</span> <span class="pl-smi">H</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>newMultinomialDynamicVariable(<span class="pl-s"><span class="pl-pds">"</span>H<span class="pl-pds">"</span></span>, <span class="pl-c1">2</span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">H_Interface</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getInterfaceVariable(<span class="pl-smi">H</span>);

<span class="pl-c">/**</span>
<span class="pl-c">* Once we have defined your {@link DynamicVariables} object, including the latent variable,</span>
<span class="pl-c">* the next step is to create a DynamicDAG structure over this set of variables.</span>
<span class="pl-c">*/</span>

<span class="pl-smi">DynamicDAG</span> dynamicDAG <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DynamicDAG</span>(dynamicVariables);

<span class="pl-c">/*</span>
<span class="pl-c">* 1. To add parents to each variable, we first recover the ParentSet object by the method</span>
<span class="pl-c">* getParentSet(Variable var) and then call the method addParent(Variable var).</span>
<span class="pl-c">*</span>
<span class="pl-c">* 2. We just assign the hidden variable as parent of all the other variables (except A), and</span>
<span class="pl-c">* link it temporally.</span>
<span class="pl-c">*/</span>

<span class="pl-c">// Time 0: Parents at time 0 are automatically created when adding parents at time T.</span>
dynamicDAG<span class="pl-k">.</span>getParentSetsTimeT()<span class="pl-k">.</span>stream()
        .filter(pset <span class="pl-k">-</span><span class="pl-k">&gt;</span> pset<span class="pl-k">.</span>getMainVar()<span class="pl-k">.</span>getVarID() <span class="pl-k">!=</span> <span class="pl-smi">A</span><span class="pl-k">.</span>getVarID())
        .filter(pset <span class="pl-k">-</span><span class="pl-k">&gt;</span> pset<span class="pl-k">.</span>getMainVar()<span class="pl-k">.</span>getVarID() <span class="pl-k">!=</span> <span class="pl-smi">H</span><span class="pl-k">.</span>getVarID())
        .forEach(pset <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
            pset<span class="pl-k">.</span>addParent(<span class="pl-smi">A</span>);
            pset<span class="pl-k">.</span>addParent(<span class="pl-smi">H</span>);
        });
dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">A</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">A_Interface</span>);
dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">B</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">B_Interface</span>);
dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">E</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">E_Interface</span>);
dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">G</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">G_Interface</span>);
dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">H</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">H_Interface</span>);

<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(dynamicDAG<span class="pl-k">.</span>toString());

<span class="pl-c">/**</span>
<span class="pl-c">* 1. Create the Dynamic Bayesian network from the previous Dynamic DAG.</span>
<span class="pl-c">*</span>
<span class="pl-c">* 2. The DBN object is created from the DynamicDAG. It automatically looks at the distribution type</span>
<span class="pl-c">* of each variable and their parents to initialize the Distributions objects that are stored</span>
<span class="pl-c">* inside (i.e. Multinomial, Normal, CLG, etc). The parameters defining these distributions are</span>
<span class="pl-c">* properly initialized.</span>
<span class="pl-c">*</span>
<span class="pl-c">* 3. The network is printed and we can have a look at the kind of distributions stored in the DBN object.</span>
<span class="pl-c">*/</span>
<span class="pl-smi">DynamicBayesianNetwork</span> dbn <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DynamicBayesianNetwork</span>(dynamicDAG);
<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>printf(dbn<span class="pl-k">.</span>toString());

<span class="pl-c">/**</span>
<span class="pl-c">* Finally the created Dynamic Bayesian network is saved to a file.</span>
<span class="pl-c">*/</span>
<span class="pl-smi">DynamicBayesianNetworkWriter</span><span class="pl-k">.</span>saveToFile(dbn, <span class="pl-s"><span class="pl-pds">"</span>networks/DBNExample.bn<span class="pl-pds">"</span></span>);</pre></div>

<p><a href="#documentation">[Back to Top]</a></p>

<h3>
<a id="modifying-dynamic-bayesian-networks-" class="anchor" href="#modifying-dynamic-bayesian-networks-" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Modifying Dynamic Bayesian Networks <a name="dynamicbnmodify"></a>
</h3>

<p>This example shows how to access and modify the conditional probabilities of a Dynamic Bayesian network model.</p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">/**</span>
<span class="pl-c">* 1. Load the data stream and create the dynamic DAG.</span>
<span class="pl-c">*/</span>
<span class="pl-k">DataStream&lt;<span class="pl-smi">DynamicDataInstance</span>&gt;</span> data <span class="pl-k">=</span> <span class="pl-smi">DynamicDataStreamLoader</span><span class="pl-k">.</span>loadFromFile(
                <span class="pl-s"><span class="pl-pds">"</span>datasets/syntheticDataDiscrete.arff<span class="pl-pds">"</span></span>);

<span class="pl-smi">DynamicVariables</span> dynamicVariables <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DynamicVariables</span>(data<span class="pl-k">.</span>getAttributes());
<span class="pl-smi">DynamicDAG</span> dynamicDAG <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DynamicDAG</span>(dynamicVariables);

<span class="pl-smi">Variable</span> <span class="pl-smi">A</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getVariableByName(<span class="pl-s"><span class="pl-pds">"</span>A<span class="pl-pds">"</span></span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">B</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getVariableByName(<span class="pl-s"><span class="pl-pds">"</span>B<span class="pl-pds">"</span></span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">C</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getVariableByName(<span class="pl-s"><span class="pl-pds">"</span>C<span class="pl-pds">"</span></span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">D</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getVariableByName(<span class="pl-s"><span class="pl-pds">"</span>D<span class="pl-pds">"</span></span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">E</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getVariableByName(<span class="pl-s"><span class="pl-pds">"</span>E<span class="pl-pds">"</span></span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">G</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getVariableByName(<span class="pl-s"><span class="pl-pds">"</span>G<span class="pl-pds">"</span></span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">A_Interface</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getInterfaceVariable(<span class="pl-smi">A</span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">B_Interface</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getInterfaceVariable(<span class="pl-smi">B</span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">E_Interface</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getInterfaceVariable(<span class="pl-smi">E</span>);
<span class="pl-smi">Variable</span> <span class="pl-smi">G_Interface</span> <span class="pl-k">=</span> dynamicVariables<span class="pl-k">.</span>getInterfaceVariable(<span class="pl-smi">G</span>);

dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">B</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">A</span>);
dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">C</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">A</span>);
dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">D</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">A</span>);
dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">E</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">A</span>);
dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">G</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">A</span>);
dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">A</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">A_Interface</span>);
dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">B</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">B_Interface</span>);
dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">E</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">E_Interface</span>);
dynamicDAG<span class="pl-k">.</span>getParentSetTimeT(<span class="pl-smi">G</span>)<span class="pl-k">.</span>addParent(<span class="pl-smi">G_Interface</span>);

<span class="pl-smi">DynamicBayesianNetwork</span> dbn <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DynamicBayesianNetwork</span>(dynamicDAG);
<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>printf(dbn<span class="pl-k">.</span>toString());

<span class="pl-c">/*</span>
<span class="pl-c">* 2. Modify the conditional probability distributions (CPDs) to new assigned values.</span>
<span class="pl-c">* IMPORTANT: The parents are indexed according to Koller (Chapter 10. Pag. 358). Example:</span>
<span class="pl-c">*  Parents: A = {A0,A1} and B = {B0,B1,B2}.</span>
<span class="pl-c">*  NumberOfPossibleAssignments = 6</span>
<span class="pl-c">*  Index   A    B</span>
<span class="pl-c">*   0     A0   B0</span>
<span class="pl-c">*   1     A1   B1</span>
<span class="pl-c">*   2     A0   B2</span>
<span class="pl-c">*   3     A1   B0</span>
<span class="pl-c">*   4     A0   B1</span>
<span class="pl-c">*   5     A1   B2</span>
<span class="pl-c">*/</span>

<span class="pl-c">// *********************** Modifiy the CPDs at TIME 0 ***********************************</span>

<span class="pl-c">// Variable A</span>
<span class="pl-smi">Multinomial</span> distA_Time0 <span class="pl-k">=</span> dbn<span class="pl-k">.</span>getConditionalDistributionTime0(<span class="pl-smi">A</span>);
distA_Time0<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.3</span>, <span class="pl-c1">0.7</span>});

<span class="pl-c">// Variable B</span>
<span class="pl-smi">Multinomial_MultinomialParents</span> distB_Time0 <span class="pl-k">=</span> dbn<span class="pl-k">.</span>getConditionalDistributionTime0(<span class="pl-smi">B</span>);
distB_Time0<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">0</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.4</span>, <span class="pl-c1">0.1</span>, <span class="pl-c1">0.5</span>});
distB_Time0<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">1</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.2</span>, <span class="pl-c1">0.5</span>, <span class="pl-c1">0.3</span>});

<span class="pl-c">// Variable C</span>
<span class="pl-smi">Multinomial_MultinomialParents</span> distC_Time0 <span class="pl-k">=</span> dbn<span class="pl-k">.</span>getConditionalDistributionTime0(<span class="pl-smi">C</span>);
distC_Time0<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">0</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.4</span>, <span class="pl-c1">0.6</span>});
distC_Time0<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">1</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.2</span>, <span class="pl-c1">0.8</span>});

<span class="pl-c">// Variable D</span>
<span class="pl-smi">Multinomial_MultinomialParents</span> distD_Time0 <span class="pl-k">=</span> dbn<span class="pl-k">.</span>getConditionalDistributionTime0(<span class="pl-smi">D</span>);
distD_Time0<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">0</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.7</span>, <span class="pl-c1">0.3</span>});
distD_Time0<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">1</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.1</span>, <span class="pl-c1">0.9</span>});

<span class="pl-c">// Variable E</span>
<span class="pl-smi">Multinomial_MultinomialParents</span> distE_Time0 <span class="pl-k">=</span> dbn<span class="pl-k">.</span>getConditionalDistributionTime0(<span class="pl-smi">E</span>);
distE_Time0<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">0</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.8</span>, <span class="pl-c1">0.2</span>});
distE_Time0<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">1</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.1</span>, <span class="pl-c1">0.9</span>});

<span class="pl-c">// Variable G</span>
<span class="pl-smi">Multinomial_MultinomialParents</span> distG_Time0 <span class="pl-k">=</span> dbn<span class="pl-k">.</span>getConditionalDistributionTime0(<span class="pl-smi">G</span>);
distG_Time0<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">0</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.6</span>, <span class="pl-c1">0.4</span>});
distG_Time0<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">1</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.7</span>, <span class="pl-c1">0.3</span>});

<span class="pl-c">// ************************ Modifiy the CPDs at TIME T ***********************************</span>

<span class="pl-c">// Variable A</span>
<span class="pl-smi">Multinomial_MultinomialParents</span> distA_TimeT <span class="pl-k">=</span> dbn<span class="pl-k">.</span>getConditionalDistributionTimeT(<span class="pl-smi">A</span>);
distA_TimeT<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">0</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.15</span>, <span class="pl-c1">0.85</span>});
distA_TimeT<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">1</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.1</span>, <span class="pl-c1">0.9</span>});

<span class="pl-c">// Variable B</span>
<span class="pl-smi">Multinomial_MultinomialParents</span> distB_TimeT <span class="pl-k">=</span> dbn<span class="pl-k">.</span>getConditionalDistributionTimeT(<span class="pl-smi">B</span>);
distB_TimeT<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">0</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.1</span>, <span class="pl-c1">0.2</span>, <span class="pl-c1">0.7</span>});
distB_TimeT<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">1</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.6</span>, <span class="pl-c1">0.1</span>, <span class="pl-c1">0.3</span>});
distB_TimeT<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">2</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.3</span>, <span class="pl-c1">0.4</span>, <span class="pl-c1">0.3</span>});
distB_TimeT<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">3</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.2</span>, <span class="pl-c1">0.1</span>, <span class="pl-c1">0.7</span>});
distB_TimeT<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">4</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.5</span>, <span class="pl-c1">0.1</span>, <span class="pl-c1">0.4</span>});
distB_TimeT<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">5</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.1</span>, <span class="pl-c1">0.1</span>, <span class="pl-c1">0.8</span>});

<span class="pl-c">// Variable C: equals to the distribution at time 0 (C does not have temporal clone)</span>
<span class="pl-smi">Multinomial_MultinomialParents</span> distC_TimeT <span class="pl-k">=</span> dbn<span class="pl-k">.</span>getConditionalDistributionTimeT(<span class="pl-smi">C</span>);
distC_TimeT<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">0</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.4</span>, <span class="pl-c1">0.6</span>});
distC_TimeT<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">1</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.2</span>, <span class="pl-c1">0.8</span>});

<span class="pl-c">// Variable D: equals to the distribution at time 0 (D does not have temporal clone)</span>
<span class="pl-smi">Multinomial_MultinomialParents</span> distD_TimeT <span class="pl-k">=</span> dbn<span class="pl-k">.</span>getConditionalDistributionTimeT(<span class="pl-smi">D</span>);
distD_TimeT<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">0</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.7</span>, <span class="pl-c1">0.3</span>});
distD_TimeT<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">1</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.1</span>, <span class="pl-c1">0.9</span>});

<span class="pl-c">// Variable E</span>
<span class="pl-smi">Multinomial_MultinomialParents</span> distE_TimeT <span class="pl-k">=</span> dbn<span class="pl-k">.</span>getConditionalDistributionTimeT(<span class="pl-smi">E</span>);
distE_TimeT<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">0</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.3</span>, <span class="pl-c1">0.7</span>});
distE_TimeT<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">1</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.6</span>, <span class="pl-c1">0.4</span>});
distE_TimeT<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">2</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.7</span>, <span class="pl-c1">0.3</span>});
distE_TimeT<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">3</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.9</span>, <span class="pl-c1">0.1</span>});

<span class="pl-c">// Variable G</span>
<span class="pl-smi">Multinomial_MultinomialParents</span> distG_TimeT <span class="pl-k">=</span> dbn<span class="pl-k">.</span>getConditionalDistributionTimeT(<span class="pl-smi">G</span>);
distG_TimeT<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">0</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.2</span>, <span class="pl-c1">0.8</span>});
distG_TimeT<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">1</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.5</span>, <span class="pl-c1">0.5</span>});
distG_TimeT<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">2</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.3</span>, <span class="pl-c1">0.7</span>});
distG_TimeT<span class="pl-k">.</span>getMultinomial(<span class="pl-c1">3</span>)<span class="pl-k">.</span>setProbabilities(<span class="pl-k">new</span> <span class="pl-smi">double</span>[]{<span class="pl-c1">0.8</span>, <span class="pl-c1">0.2</span>});

<span class="pl-c">/*</span>
<span class="pl-c">* Print the new modeified DBN</span>
<span class="pl-c">*/</span>
<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(dbn<span class="pl-k">.</span>toString());</pre></div>

<p><a href="#documentation">[Back to Top]</a></p>

<h2>
<a id="sampling-from-dynamic-bayesian-networks-" class="anchor" href="#sampling-from-dynamic-bayesian-networks-" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Sampling from Dynamic Bayesian Networks <a name="sampledynamicbn"></a>
</h2>

<p>This example shows how to use the DynamicBayesianNetworkSampler class to randomly generate a dynamic data stream from a given Dynamic Bayesian network.</p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">//Randomly generate a DBN with 3 continuous and 3 discrete variables with 2 states</span>
<span class="pl-smi">DynamicBayesianNetworkGenerator</span> dbnGenerator <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DynamicBayesianNetworkGenerator</span>();
dbnGenerator<span class="pl-k">.</span>setNumberOfContinuousVars(<span class="pl-c1">3</span>);
dbnGenerator<span class="pl-k">.</span>setNumberOfDiscreteVars(<span class="pl-c1">3</span>);
dbnGenerator<span class="pl-k">.</span>setNumberOfStates(<span class="pl-c1">2</span>);

<span class="pl-c">//Create a Naive Bayes like structure with temporal links in the children (leaves) and 2 states for</span>
<span class="pl-c">//the class variable</span>
<span class="pl-smi">DynamicBayesianNetwork</span> network <span class="pl-k">=</span> <span class="pl-smi">DynamicBayesianNetworkGenerator</span><span class="pl-k">.</span>generateDynamicNaiveBayes(
                <span class="pl-k">new</span> <span class="pl-smi">Random</span>(<span class="pl-c1">0</span>), <span class="pl-c1">2</span>, <span class="pl-c1">true</span>);

<span class="pl-c">//Create the sampler from this network</span>
<span class="pl-smi">DynamicBayesianNetworkSampler</span> sampler <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DynamicBayesianNetworkSampler</span>(network);
sampler<span class="pl-k">.</span>setSeed(<span class="pl-c1">0</span>);

<span class="pl-c">//Sample a dataStream of 3 sequences of 1000 samples each</span>
<span class="pl-k">DataStream&lt;<span class="pl-smi">DynamicDataInstance</span>&gt;</span> dataStream <span class="pl-k">=</span> sampler<span class="pl-k">.</span>sampleToDataBase(<span class="pl-c1">3</span>,<span class="pl-c1">1000</span>);

<span class="pl-c">//Save the created data stream in a file</span>
<span class="pl-smi">DataStreamWriter</span><span class="pl-k">.</span>writeDataToFile(dataStream, <span class="pl-s"><span class="pl-pds">"</span>./datasets/dnb-samples.arff<span class="pl-pds">"</span></span>);</pre></div>

<p><a href="#documentation">[Back to Top]</a></p>

<h2>
<a id="inference-algorithms-for-dynamic-bayesian-networks-" class="anchor" href="#inference-algorithms-for-dynamic-bayesian-networks-" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Inference Algorithms for Dynamic Bayesian Networks <a name="dynamicinferenceexample"></a>
</h2>

<h3>
<a id="the-dynamic-map-inference-" class="anchor" href="#the-dynamic-map-inference-" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The Dynamic MAP Inference <a name="dynamicmap"></a>
</h3>

<p>This example shows how to use the Dynamic MAP Inference algorithm.</p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">//Generate a random DBN model</span>
<span class="pl-smi">DynamicBayesianNetworkGenerator</span><span class="pl-k">.</span>setNumberOfContinuousVars(<span class="pl-c1">3</span>);
<span class="pl-smi">DynamicBayesianNetworkGenerator</span><span class="pl-k">.</span>setNumberOfDiscreteVars(<span class="pl-c1">5</span>);
<span class="pl-smi">DynamicBayesianNetworkGenerator</span><span class="pl-k">.</span>setNumberOfStates(<span class="pl-c1">2</span>);
<span class="pl-smi">DynamicBayesianNetworkGenerator</span><span class="pl-k">.</span>setNumberOfLinks(<span class="pl-c1">5</span>);
<span class="pl-smi">DynamicBayesianNetwork</span> dynamicBayesianNetwork <span class="pl-k">=</span> <span class="pl-smi">DynamicBayesianNetworkGenerator</span><span class="pl-k">.</span>generateDynamicNaiveBayes(<span class="pl-k">new</span> <span class="pl-smi">Random</span>(<span class="pl-c1">0</span>), <span class="pl-c1">2</span>, <span class="pl-c1">true</span>);

<span class="pl-c">//Initialize the Dynamic MAP object</span>
<span class="pl-k">int</span> nTimeSteps <span class="pl-k">=</span> <span class="pl-c1">6</span>;
<span class="pl-smi">eu.amidst.dynamic.inference<span class="pl-k">.</span>DynamicMAPInference</span> dynMAP <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">eu.amidst.dynamic.inference<span class="pl-k">.</span>DynamicMAPInference</span>();
dynMAP<span class="pl-k">.</span>setModel(dynamicBayesianNetwork);
dynMAP<span class="pl-k">.</span>setNumberOfTimeSteps(nTimeSteps);

<span class="pl-smi">Variable</span> mapVariable <span class="pl-k">=</span> dynamicBayesianNetwork<span class="pl-k">.</span>getDynamicVariables()<span class="pl-k">.</span>getVariableByName(<span class="pl-s"><span class="pl-pds">"</span>ClassVar<span class="pl-pds">"</span></span>);
dynMAP<span class="pl-k">.</span>setMAPvariable(mapVariable);

<span class="pl-c">//Generate an evidence for T=0,...,nTimeSteps-1</span>
<span class="pl-k">List&lt;<span class="pl-smi">Variable</span>&gt;</span> varsDynamicModel <span class="pl-k">=</span> dynamicBayesianNetwork<span class="pl-k">.</span>getDynamicVariables()<span class="pl-k">.</span>getListOfDynamicVariables();

<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>DYNAMIC VARIABLES:<span class="pl-pds">"</span></span>);
varsDynamicModel<span class="pl-k">.</span>forEach(var <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>Var ID <span class="pl-pds">"</span></span> <span class="pl-k">+</span> var<span class="pl-k">.</span>getVarID() <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> var<span class="pl-k">.</span>getName()));
<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println();
<span class="pl-k">int</span> indexVarEvidence1 <span class="pl-k">=</span> <span class="pl-c1">2</span>;
<span class="pl-k">int</span> indexVarEvidence2 <span class="pl-k">=</span> <span class="pl-c1">3</span>;
<span class="pl-k">int</span> indexVarEvidence3 <span class="pl-k">=</span> <span class="pl-c1">4</span>;
<span class="pl-smi">Variable</span> varEvidence1 <span class="pl-k">=</span> varsDynamicModel<span class="pl-k">.</span>get(indexVarEvidence1);
<span class="pl-smi">Variable</span> varEvidence2 <span class="pl-k">=</span> varsDynamicModel<span class="pl-k">.</span>get(indexVarEvidence2);
<span class="pl-smi">Variable</span> varEvidence3 <span class="pl-k">=</span> varsDynamicModel<span class="pl-k">.</span>get(indexVarEvidence3);

<span class="pl-k">List&lt;<span class="pl-smi">Variable</span>&gt;</span> varsEvidence <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-k">ArrayList&lt;&gt;</span>(<span class="pl-c1">3</span>);
varsEvidence<span class="pl-k">.</span>add(<span class="pl-c1">0</span>,varEvidence1);
varsEvidence<span class="pl-k">.</span>add(<span class="pl-c1">1</span>,varEvidence2);
varsEvidence<span class="pl-k">.</span>add(<span class="pl-c1">2</span>,varEvidence3);

<span class="pl-k">double</span> varEvidenceValue;

<span class="pl-smi">Random</span> random <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Random</span>(<span class="pl-c1">4634</span>);

<span class="pl-k">List&lt;<span class="pl-smi">DynamicAssignment</span>&gt;</span> evidence <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-k">ArrayList&lt;&gt;</span>(nTimeSteps);

<span class="pl-k">for</span> (<span class="pl-k">int</span> t <span class="pl-k">=</span> <span class="pl-c1">0</span>; t <span class="pl-k">&lt;</span> nTimeSteps; t<span class="pl-k">++</span>) {
   <span class="pl-smi">HashMapDynamicAssignment</span> dynAssignment <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">HashMapDynamicAssignment</span>(varsEvidence<span class="pl-k">.</span>size());

   <span class="pl-k">for</span> (<span class="pl-k">int</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> varsEvidence<span class="pl-k">.</span>size(); i<span class="pl-k">++</span>) {

        dynAssignment<span class="pl-k">.</span>setSequenceID(<span class="pl-c1">12302253</span>);
        dynAssignment<span class="pl-k">.</span>setTimeID(t);
        <span class="pl-smi">Variable</span> varEvidence <span class="pl-k">=</span> varsEvidence<span class="pl-k">.</span>get(i);

        <span class="pl-k">if</span> (varEvidence<span class="pl-k">.</span>isMultinomial()) {
             varEvidenceValue <span class="pl-k">=</span> random<span class="pl-k">.</span>nextInt(varEvidence1<span class="pl-k">.</span>getNumberOfStates());
        } <span class="pl-k">else</span> {
             varEvidenceValue <span class="pl-k">=</span> <span class="pl-k">-</span><span class="pl-c1">5</span> <span class="pl-k">+</span> <span class="pl-c1">10</span> <span class="pl-k">*</span> random<span class="pl-k">.</span>nextDouble();
        }
             dynAssignment<span class="pl-k">.</span>setValue(varEvidence, varEvidenceValue);
        }
        evidence<span class="pl-k">.</span>add(dynAssignment);
    }
    <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>EVIDENCE:<span class="pl-pds">"</span></span>);
    evidence<span class="pl-k">.</span>forEach(evid <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
    <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>Evidence at time <span class="pl-pds">"</span></span> <span class="pl-k">+</span> evid<span class="pl-k">.</span>getTimeID());
    evid<span class="pl-k">.</span>getVariables()<span class="pl-k">.</span>forEach(variable <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(variable<span class="pl-k">.</span>getName() <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-smi">Integer</span><span class="pl-k">.</span>toString((<span class="pl-k">int</span>) evid<span class="pl-k">.</span>getValue(variable))));
    <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println();
});

<span class="pl-c">//Set the evidence and run the inference process</span>
dynMAP<span class="pl-k">.</span>setEvidence(evidence);
dynMAP<span class="pl-k">.</span>runInference(<span class="pl-smi">eu.amidst.dynamic.inference<span class="pl-k">.</span>DynamicMAPInference</span><span class="pl-k">.</span><span class="pl-smi">SearchAlgorithm</span><span class="pl-c1"><span class="pl-k">.</span>IS</span>);

<span class="pl-c">//Display the results</span>
<span class="pl-smi">Assignment</span> <span class="pl-smi">MAPestimate</span> <span class="pl-k">=</span> dynMAP<span class="pl-k">.</span>getMAPestimate();
<span class="pl-k">double</span> <span class="pl-smi">MAPestimateProbability</span> <span class="pl-k">=</span> dynMAP<span class="pl-k">.</span>getMAPestimateProbability();

<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>MAP sequence over <span class="pl-pds">"</span></span> <span class="pl-k">+</span> mapVariable<span class="pl-k">.</span>getName() <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>:<span class="pl-pds">"</span></span>);
<span class="pl-k">List&lt;<span class="pl-smi">Variable</span>&gt;</span> <span class="pl-smi">MAPvarReplications</span> <span class="pl-k">=</span> <span class="pl-smi">MAPestimate</span><span class="pl-k">.</span>getVariables()<span class="pl-k">.</span>stream()<span class="pl-k">.</span>sorted((var1,var2) <span class="pl-k">-</span><span class="pl-k">&gt;</span> (var1<span class="pl-k">.</span>getVarID()<span class="pl-k">&gt;</span>var2<span class="pl-k">.</span>getVarID()<span class="pl-k">?</span> <span class="pl-c1">1</span> <span class="pl-k">:</span> <span class="pl-k">-</span><span class="pl-c1">1</span>))<span class="pl-k">.</span>collect(<span class="pl-smi">Collectors</span><span class="pl-k">.</span>toList());

<span class="pl-smi">StringBuilder</span> sequence <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">StringBuilder</span>();
<span class="pl-smi">MAPvarReplications</span><span class="pl-k">.</span>stream()<span class="pl-k">.</span>forEachOrdered(var <span class="pl-k">-</span><span class="pl-k">&gt;</span> sequence<span class="pl-k">.</span>append(<span class="pl-smi">Integer</span><span class="pl-k">.</span>toString((<span class="pl-k">int</span>) <span class="pl-smi">MAPestimate</span><span class="pl-k">.</span>getValue(var)) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>, <span class="pl-pds">"</span></span>));
<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(sequence<span class="pl-k">.</span>toString());
<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>with probability prop. to: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-smi">MAPestimateProbability</span>);</pre></div>

<p><a href="#documentation">[Back to Top]</a></p>

<h3>
<a id="the-dynamic-variational-message-passing-" class="anchor" href="#the-dynamic-variational-message-passing-" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The Dynamic Variational Message Passing <a name="dynamicvmp"></a>
</h3>

<p>This example shows how to use the Factored Frontier algorithm with Variational Message Passing for running inference on dynamic Bayesian networks.</p>

<div class="highlight highlight-source-java"><pre>
<span class="pl-c">//Generate a dynamic Bayesian network (NB structure with class and attributes temporally linked)</span>
<span class="pl-smi">DynamicBayesianNetworkGenerator</span><span class="pl-k">.</span>setNumberOfContinuousVars(<span class="pl-c1">2</span>);
<span class="pl-smi">DynamicBayesianNetworkGenerator</span><span class="pl-k">.</span>setNumberOfDiscreteVars(<span class="pl-c1">5</span>);
<span class="pl-smi">DynamicBayesianNetworkGenerator</span><span class="pl-k">.</span>setNumberOfStates(<span class="pl-c1">3</span>);
<span class="pl-smi">DynamicBayesianNetwork</span> extendedDBN <span class="pl-k">=</span> <span class="pl-smi">DynamicBayesianNetworkGenerator</span><span class="pl-k">.</span>generateDynamicNaiveBayes(random,<span class="pl-c1">2</span>,<span class="pl-c1">true</span>);

<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(extendedDBN<span class="pl-k">.</span>toString());

<span class="pl-c">//Select the target variable for inference, in this case it corresponds to the class variable</span>
<span class="pl-smi">Variable</span> classVar <span class="pl-k">=</span> extendedDBN<span class="pl-k">.</span>getDynamicVariables()<span class="pl-k">.</span>getVariableByName(<span class="pl-s"><span class="pl-pds">"</span>ClassVar<span class="pl-pds">"</span></span>);


<span class="pl-c">//Create a dynamic data stream with 3 sequences for prediction. The class var is made hidden.</span>
<span class="pl-smi">DynamicBayesianNetworkSampler</span> dynamicSampler <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DynamicBayesianNetworkSampler</span>(extendedDBN);
dynamicSampler<span class="pl-k">.</span>setHiddenVar(classVar);
<span class="pl-k">DataStream&lt;<span class="pl-smi">DynamicDataInstance</span>&gt;</span> dataPredict <span class="pl-k">=</span> dynamicSampler<span class="pl-k">.</span>sampleToDataBase(<span class="pl-c1">3</span>,<span class="pl-c1">100</span>);


<span class="pl-c">//Select VMP with the factored frontier algorithm as the Inference Algorithm</span>
<span class="pl-smi">FactoredFrontierForDBN</span> <span class="pl-smi">FFalgorithm</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">FactoredFrontierForDBN</span>(<span class="pl-k">new</span> <span class="pl-smi">VMP</span>());
<span class="pl-smi">InferenceEngineForDBN</span><span class="pl-k">.</span>setInferenceAlgorithmForDBN(<span class="pl-smi">FFalgorithm</span>);

<span class="pl-c">//Set the DBN model</span>
<span class="pl-smi">InferenceEngineForDBN</span><span class="pl-k">.</span>setModel(extendedDBN);

<span class="pl-k">int</span> time <span class="pl-k">=</span> <span class="pl-c1">0</span> ;
<span class="pl-smi">UnivariateDistribution</span> posterior <span class="pl-k">=</span> <span class="pl-c1">null</span>;
<span class="pl-k">for</span> (<span class="pl-smi">DynamicDataInstance</span> instance <span class="pl-k">:</span> dataPredict) {

   <span class="pl-c">//The InferenceEngineForDBN must be reset at the beginning of each Sequence.</span>
   <span class="pl-k">if</span> (instance<span class="pl-k">.</span>getTimeID()<span class="pl-k">==</span><span class="pl-c1">0</span> <span class="pl-k">&amp;&amp;</span> posterior <span class="pl-k">!=</span> <span class="pl-c1">null</span>) {
       <span class="pl-smi">InferenceEngineForDBN</span><span class="pl-k">.</span>reset();
       time<span class="pl-k">=</span><span class="pl-c1">0</span>;
   }

   <span class="pl-c">//Set the evidence </span>
   <span class="pl-smi">InferenceEngineForDBN</span><span class="pl-k">.</span>addDynamicEvidence(instance);

   <span class="pl-c">//Run the inference process</span>
   <span class="pl-smi">InferenceEngineForDBN</span><span class="pl-k">.</span>runInference();

   <span class="pl-c">//Query the posterior of the target variable</span>
   posterior <span class="pl-k">=</span> <span class="pl-smi">InferenceEngineForDBN</span><span class="pl-k">.</span>getFilteredPosterior(classVar);

   <span class="pl-c">//Display the output</span>
   <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>P(ClassVar|e[0:<span class="pl-pds">"</span></span><span class="pl-k">+</span>(time<span class="pl-k">++</span>)<span class="pl-k">+</span><span class="pl-s"><span class="pl-pds">"</span>]) = <span class="pl-pds">"</span></span><span class="pl-k">+</span>posterior);
}</pre></div>

<p><a href="#documentation">[Back to Top]</a></p>

<h3>
<a id="the-dynamic-importance-sampling-" class="anchor" href="#the-dynamic-importance-sampling-" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The Dynamic Importance Sampling <a name="dynamicis"></a>
</h3>

<p>This example shows how to use the Factored Frontier algorithm with Importance Sampling for running inference in dynamic Bayesian networks.</p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">//Generate a dynamic Bayesian network (NB structure with class and attributes temporally linked)</span>
<span class="pl-smi">DynamicBayesianNetworkGenerator</span><span class="pl-k">.</span>setNumberOfContinuousVars(<span class="pl-c1">2</span>);
<span class="pl-smi">DynamicBayesianNetworkGenerator</span><span class="pl-k">.</span>setNumberOfDiscreteVars(<span class="pl-c1">5</span>);
<span class="pl-smi">DynamicBayesianNetworkGenerator</span><span class="pl-k">.</span>setNumberOfStates(<span class="pl-c1">3</span>);
<span class="pl-smi">DynamicBayesianNetwork</span> extendedDBN <span class="pl-k">=</span> <span class="pl-smi">DynamicBayesianNetworkGenerator</span><span class="pl-k">.</span>generateDynamicNaiveBayes(random, <span class="pl-c1">2</span>, <span class="pl-c1">true</span>);

<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(extendedDBN<span class="pl-k">.</span>toString());

<span class="pl-c">//Select the target variable for inference, in this case the class variable</span>
<span class="pl-smi">Variable</span> classVar <span class="pl-k">=</span> extendedDBN<span class="pl-k">.</span>getDynamicVariables()<span class="pl-k">.</span>getVariableByName(<span class="pl-s"><span class="pl-pds">"</span>ClassVar<span class="pl-pds">"</span></span>);

<span class="pl-c">//Create a dynamic dataset with 3 sequences for prediction. The class var is made hidden.</span>
<span class="pl-smi">DynamicBayesianNetworkSampler</span> dynamicSampler <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DynamicBayesianNetworkSampler</span>(extendedDBN);
dynamicSampler<span class="pl-k">.</span>setHiddenVar(classVar);
<span class="pl-k">DataStream&lt;<span class="pl-smi">DynamicDataInstance</span>&gt;</span> dataPredict <span class="pl-k">=</span> dynamicSampler<span class="pl-k">.</span>sampleToDataBase(<span class="pl-c1">3</span>, <span class="pl-c1">1000</span>);

<span class="pl-c">//Select IS with the factored frontier algorithm as the Inference Algorithm</span>
<span class="pl-smi">ImportanceSampling</span> importanceSampling <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">ImportanceSampling</span>();
importanceSampling<span class="pl-k">.</span>setKeepDataOnMemory(<span class="pl-c1">true</span>);
<span class="pl-smi">FactoredFrontierForDBN</span> <span class="pl-smi">FFalgorithm</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">FactoredFrontierForDBN</span>(importanceSampling);
<span class="pl-smi">InferenceEngineForDBN</span><span class="pl-k">.</span>setInferenceAlgorithmForDBN(<span class="pl-smi">FFalgorithm</span>);

<span class="pl-c">//Set the DBN model</span>
<span class="pl-smi">InferenceEngineForDBN</span><span class="pl-k">.</span>setModel(extendedDBN);

<span class="pl-k">int</span> time <span class="pl-k">=</span> <span class="pl-c1">0</span>;
<span class="pl-smi">UnivariateDistribution</span> posterior <span class="pl-k">=</span> <span class="pl-c1">null</span>;
<span class="pl-k">for</span> (<span class="pl-smi">DynamicDataInstance</span> instance <span class="pl-k">:</span> dataPredict) {

    <span class="pl-c">//The InferenceEngineForDBN must be reset at the beginning of each Sequence.</span>
    <span class="pl-k">if</span> (instance<span class="pl-k">.</span>getTimeID() <span class="pl-k">==</span> <span class="pl-c1">0</span> <span class="pl-k">&amp;&amp;</span> posterior <span class="pl-k">!=</span> <span class="pl-c1">null</span>) {
        <span class="pl-smi">InferenceEngineForDBN</span><span class="pl-k">.</span>reset();
        time <span class="pl-k">=</span> <span class="pl-c1">0</span>;
     }

    <span class="pl-c">//Set the evidence.</span>
    <span class="pl-smi">InferenceEngineForDBN</span><span class="pl-k">.</span>addDynamicEvidence(instance);

    <span class="pl-c">//Run inference</span>
    <span class="pl-smi">InferenceEngineForDBN</span><span class="pl-k">.</span>runInference();

    <span class="pl-c">//Query the posterior of the target variable</span>
    posterior <span class="pl-k">=</span> <span class="pl-smi">InferenceEngineForDBN</span><span class="pl-k">.</span>getFilteredPosterior(classVar);

    <span class="pl-c">//Display the output</span>
    <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>P(ClassVar|e[0:<span class="pl-pds">"</span></span> <span class="pl-k">+</span> (time<span class="pl-k">++</span>) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>]) = <span class="pl-pds">"</span></span> <span class="pl-k">+</span> posterior);
}</pre></div>

<p><a href="#documentation">[Back to Top]</a></p>

<h2>
<a id="dynamic-learning-algorithms-" class="anchor" href="#dynamic-learning-algorithms-" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Dynamic Learning Algorithms <a name="dynamiclearningexample"></a>
</h2>

<h3>
<a id="maximum-likelihood-for-dbns-" class="anchor" href="#maximum-likelihood-for-dbns-" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Maximum Likelihood for DBNs <a name="dynamicml"></a>
</h3>

<p>This example shows how to learn the parameters of a dynamic Bayesian network using maximum likelihood from a randomly sampled data stream.</p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">//Generate a dynamic Bayesian network (NB structure with class and attributes temporally linked)</span>
<span class="pl-smi">DynamicBayesianNetworkGenerator</span><span class="pl-k">.</span>setNumberOfContinuousVars(<span class="pl-c1">2</span>);
<span class="pl-smi">DynamicBayesianNetworkGenerator</span><span class="pl-k">.</span>setNumberOfDiscreteVars(<span class="pl-c1">5</span>);
<span class="pl-smi">DynamicBayesianNetworkGenerator</span><span class="pl-k">.</span>setNumberOfStates(<span class="pl-c1">3</span>);
<span class="pl-smi">DynamicBayesianNetwork</span> dbnRandom <span class="pl-k">=</span> <span class="pl-smi">DynamicBayesianNetworkGenerator</span><span class="pl-k">.</span>generateDynamicNaiveBayes(random,<span class="pl-c1">2</span>,<span class="pl-c1">true</span>);

<span class="pl-c">//Sample dynamic data stream from the created dbn with random parameters</span>
<span class="pl-smi">DynamicBayesianNetworkSampler</span> sampler <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DynamicBayesianNetworkSampler</span>(dbnRandom);
sampler<span class="pl-k">.</span>setSeed(<span class="pl-c1">0</span>);
<span class="pl-k">DataStream&lt;<span class="pl-smi">DynamicDataInstance</span>&gt;</span> data <span class="pl-k">=</span> sampler<span class="pl-k">.</span>sampleToDataBase(<span class="pl-c1">3</span>,<span class="pl-c1">10000</span>);

<span class="pl-c">//Set batch size value and the parallel mode</span>
<span class="pl-smi">DynamicMaximumLikelihood</span><span class="pl-k">.</span>setBatchSize(<span class="pl-c1">1000</span>);
<span class="pl-smi">DynamicMaximumLikelihood</span><span class="pl-k">.</span>setParallelMode(<span class="pl-c1">true</span>);

<span class="pl-c">//Learn the DBN parameters with ML from data</span>
<span class="pl-smi">DynamicBayesianNetwork</span> dbnLearnt <span class="pl-k">=</span> <span class="pl-smi">DynamicMaximumLikelihood</span><span class="pl-k">.</span>learnDynamic(dbnRandom<span class="pl-k">.</span>getDynamicDAG(), data);

<span class="pl-c">//We print the learnt DBN model</span>
<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(dbnLearnt<span class="pl-k">.</span>toString());        </pre></div>

<p><a href="#documentation">[Back to Top]</a></p>

<h3>
<a id="streaming-variational-bayes-for-dbns-" class="anchor" href="#streaming-variational-bayes-for-dbns-" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Streaming Variational Bayes for DBNs <a name="dynamicsvb"></a>
</h3>

<p>This example shows how to learn the parameters of a dynamic Bayesian network using streaming variational Bayes from a randomly sampled data stream.</p>

<div class="highlight highlight-source-java"><pre>
<span class="pl-c">//Generate a dynamic Bayesian network (NB structure with class and attributes temporally linked)</span>
<span class="pl-smi">DynamicBayesianNetworkGenerator</span><span class="pl-k">.</span>setNumberOfContinuousVars(<span class="pl-c1">2</span>);
<span class="pl-smi">DynamicBayesianNetworkGenerator</span><span class="pl-k">.</span>setNumberOfDiscreteVars(<span class="pl-c1">5</span>);
<span class="pl-smi">DynamicBayesianNetworkGenerator</span><span class="pl-k">.</span>setNumberOfStates(<span class="pl-c1">3</span>);
<span class="pl-smi">DynamicBayesianNetwork</span> dbnRandom <span class="pl-k">=</span> <span class="pl-smi">DynamicBayesianNetworkGenerator</span><span class="pl-k">.</span>generateDynamicNaiveBayes(random,<span class="pl-c1">2</span>,<span class="pl-c1">true</span>);

<span class="pl-c">//Sample dynamic data stream from the created dbn with random parameters</span>
<span class="pl-smi">DynamicBayesianNetworkSampler</span> sampler <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DynamicBayesianNetworkSampler</span>(dbnRandom);
sampler<span class="pl-k">.</span>setSeed(<span class="pl-c1">0</span>);
<span class="pl-c">//Sample 3 sequences of 100K instances</span>
<span class="pl-k">DataStream&lt;<span class="pl-smi">DynamicDataInstance</span>&gt;</span> data <span class="pl-k">=</span> sampler<span class="pl-k">.</span>sampleToDataBase(<span class="pl-c1">3</span>,<span class="pl-c1">10000</span>);

<span class="pl-c">//Parameter Learning with Streaming variational Bayes</span>
<span class="pl-smi">DynamicSVB</span> svb <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DynamicSVB</span>();

<span class="pl-c">//Set the desired options for the svb</span>
svb<span class="pl-k">.</span>setWindowsSize(<span class="pl-c1">100</span>);
svb<span class="pl-k">.</span>setSeed(<span class="pl-c1">0</span>);
<span class="pl-c">//If desired, we may also set some options for the VMP</span>
<span class="pl-smi">VMP</span> vmp <span class="pl-k">=</span> svb<span class="pl-k">.</span>getDynamicPlateauStructure()<span class="pl-k">.</span>getVMPTimeT();
vmp<span class="pl-k">.</span>setOutput(<span class="pl-c1">true</span>);
vmp<span class="pl-k">.</span>setTestELBO(<span class="pl-c1">true</span>);
vmp<span class="pl-k">.</span>setMaxIter(<span class="pl-c1">1000</span>);
vmp<span class="pl-k">.</span>setThreshold(<span class="pl-c1">0.0001</span>);

<span class="pl-c">//Set the dynamicDAG, the data and start learning</span>
svb<span class="pl-k">.</span>setDynamicDAG(dbnRandom<span class="pl-k">.</span>getDynamicDAG());
svb<span class="pl-k">.</span>setDataStream(data);
svb<span class="pl-k">.</span>runLearning();

<span class="pl-c">//Get the learnt DBN model</span>
<span class="pl-smi">DynamicBayesianNetwork</span> dbnLearnt <span class="pl-k">=</span> svb<span class="pl-k">.</span>getLearntDBN();

<span class="pl-c">//Print the DBN model</span>
<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(dbnLearnt<span class="pl-k">.</span>toString());</pre></div>

<p><a href="#documentation">[Back to Top]</a></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/amidst/toolbox">AMIDST Toolbox 0.4.2</a> is maintained by <a href="https://github.com/amidst">amidst</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-66233470-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
